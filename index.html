<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video to iPhone Parallax Scroll - Reveal Frame</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: sans-serif;
            min-height: 300vh;
            background-color: #f4f4f4;
            /* Smooth scroll helps perception */
            /* scroll-behavior: smooth; /* Optional */ 
        }

        .video-scroll-section {
            height: 200vh;
            position: relative;
            margin-top: 100vh;
        }

        .iphone-container {
            /* --- Sticky Positioning --- */
            position: sticky;
            top: 50vh;

            /* --- iPhone Appearance (Landscape) --- */
            width: 700px;
            height: 350px;
            background: #111;
            border-radius: 40px;
            border: 14px solid #333;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);

            /* --- Centering & Stacking --- */
            margin-left: auto;
            margin-right: auto;
            overflow: hidden;
            z-index: 10;

            /* --- Initial State: Hidden --- */
            opacity: 0; /* Start fully transparent */
            /* Center vertically AND set initial small scale (optional) */
            transform: translateY(-50%) scale(0.6); /* Start slightly smaller */
            --max-opacity-during-transition: 0.1;
            /* --- Smooth Transition for fade-in/scale-up --- */
            transition: opacity 0.4s ease-out, transform 0.4s ease-out; /* Animate opacity and transform */
        }

        #hero-video {
            /* --- Initial State (Fullscreen Background) --- */
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            object-fit: cover;
            z-index: 5;
            /* Video transform will be handled by JS */
        }

        .content-after {
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2rem;
            color: #333;
        }
        
        /* Responsive styles */
        @media (max-width: 768px) {
            /* Smaller iPhone container for tablets */
            .iphone-container {
                width: 500px;
                height: 250px;
                border-radius: 30px;
                border-width: 10px;
            }
        }
        
        @media (max-width: 576px) {
            /* Even smaller iPhone container for phones */
            .iphone-container {
                width: 90vw; /* 90% of viewport width */
                height: 45vw; /* Maintain aspect ratio */
                border-radius: 20px;
                border-width: 8px;
            }
            
            /* Adjust scrolling distances for mobile */
            .video-scroll-section {
                height: 150vh; /* Shorter scroll distance on mobile */
            }
            
            /* Adjust text size for content after */
            .content-after {
                font-size: 1.5rem;
            }
        }
        
        /* Optional: Handle very small screens */
        @media (max-width: 360px) {
            .iphone-container {
                width: 95vw;
                height: 48vw;
                border-width: 6px;
                border-radius: 15px;
            }
        }
    </style>
</head>

<body>

    <video id="hero-video" autoplay muted loop playsinline src="./client/assets/dqnteaser.mp4"></video>

    <section class="video-scroll-section">
        <div class="iphone-container" id="iphone">
            </div>
    </section>

    <section class="content-after">
        <p>Content after the effect...</p>
    </section>


    <script>
        const video = document.getElementById('hero-video');
        const scrollSection = document.querySelector('.video-scroll-section');
        const iphoneContainer = document.getElementById('iphone');
        const maxOpacityDuringTransition = 
        parseFloat(getComputedStyle(iphoneContainer).getPropertyValue('--max-opacity-during-transition')) || 0.7;

        window.addEventListener('scroll', () => {
            const scrollSectionTop = scrollSection.offsetTop;
            const scrollSectionHeight = scrollSection.offsetHeight;
            const viewportHeight = window.innerHeight;
            const scrollY = window.scrollY;

            // Calculate scroll progress (same as before)
            const startScroll = scrollSectionTop - viewportHeight / 2;
            const endScroll = scrollSectionTop + scrollSectionHeight - viewportHeight / 2 - iphoneContainer.offsetHeight;
            let progress = (scrollY - startScroll) / (endScroll - startScroll);
            progress = Math.min(Math.max(progress, 0), 1);

            // --- Animate based on progress ---
            if (progress > 0 && progress <= 1) { // Start animating slightly after progress > 0
                const iphoneRect = iphoneContainer.getBoundingClientRect();
                const targetWidth = iphoneRect.width;
                const targetHeight = iphoneRect.height;

                const scaleX = targetWidth / window.innerWidth;
                const scaleY = targetHeight / window.innerHeight;
                const scale = 1 - (1 - Math.max(scaleX, scaleY)) * progress;

                const targetTranslateX = iphoneRect.left + targetWidth / 2 - window.innerWidth / 2;
                const targetTranslateY = iphoneRect.top + targetHeight / 2 - window.innerHeight / 2;
                const translateX = targetTranslateX * progress;
                const translateY = targetTranslateY * progress;

                // --- Control iPhone Container Visibility ---
                // Start fading/scaling in the iPhone container based on progress
                // Adjust the multiplier (e.g., 1.5) to make it appear faster
                let iphoneProgress = Math.min(progress * 1.5, 1); // Make iPhone appear slightly faster than video shrinks fully

                const iphoneScale = 0.9 + 0.1 * iphoneProgress; // Scale from 0.9 to 1

                requestAnimationFrame(() => {
                    // Video transform
                    video.style.transform = `translate(${translateX}px, ${translateY}px) scale(${scale})`;
                    video.style.zIndex = progress > 0.5 ? 11 : 5;

                    // iPhone transform and opacity
                    iphoneContainer.style.opacity = progress < 0.99 ? 
                    Math.min(0.4, iphoneProgress * maxOpacityDuringTransition) : 
                    0.8;
                    iphoneContainer.style.transform = `translateY(-50%) scale(${iphoneScale})`;
                    // Ensure it's sticky *only* when visible to prevent layout shifts if possible
                    iphoneContainer.style.position = iphoneProgress > 0 ? 'sticky' : 'relative';
                });

                 // --- Handle Unpinning ---
                 // If scrolling back up, detach video from iPhone if it was attached
                 if (video.parentElement === iphoneContainer && video.style.position === 'absolute') {
                    requestAnimationFrame(() => {
                        document.body.appendChild(video);
                        video.style.position = 'fixed';
                        video.style.width = '100vw';
                        video.style.height = '100vh';
                        // Transform is handled above based on progress
                    });
                }


            } else if (scrollY < startScroll) {
                // --- Reset to Initial State ---
                requestAnimationFrame(() => {
                    // Reset Video
                    video.style.transform = `translate(0, 0) scale(1)`;
                    if (video.style.position !== 'fixed') { // Avoid unnecessary style changes
                        video.style.position = 'fixed';
                        video.style.top = '0';
                        video.style.left = '0';
                        video.style.width = '100vw';
                        video.style.height = '100vh';
                        video.style.zIndex = 5;
                    }
                    // Reset iPhone (make it invisible and small again)
                    iphoneContainer.style.opacity = 0;
                    iphoneContainer.style.transform = `translateY(-50%) scale(0.9)`;
                    iphoneContainer.style.position = 'relative'; // Ensure it's not sticky before it's visible
                });
            }

            // --- Pin Video Inside when done ---
            if (progress >= 0.99) {
                 requestAnimationFrame(() => {
                    // Only change position and parent if not already done
                     if (video.style.position !== 'absolute') {
                         video.style.position = 'absolute';
                         video.style.top = '0';
                         video.style.left = '0';
                         video.style.width = '100%';
                         video.style.height = '100%';
                         video.style.transform = 'none';
                         video.style.zIndex = 11;
                         if (video.parentElement !== iphoneContainer) {
                            iphoneContainer.appendChild(video);
                         }
                     }
                     // Ensure iPhone is fully visible and scaled
                     iphoneContainer.style.opacity = 1;
                     iphoneContainer.style.transform = `translateY(-50%) scale(1)`;
                     iphoneContainer.style.position = 'sticky';
                 });
             }
        });
    </script>

</body>
</html>